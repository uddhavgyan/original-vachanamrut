{{ $currentLang := .Page.Language.Lang }}

<div class="vachanamrut-hybrid-tabs">

  <!-- Main Tabs -->
  <div class="main-tabs">
    <button class="main-tab active" data-section="harivakya">શ્રીહરિવાક્યસુધાસિંધુ</button>
    <button class="main-tab" data-section="setumala">સેતુમાળા ટીકા</button>
  </div>

  <!-- Harivakya Section -->
  <div id="harivakya" class="section active">
    <h2>શ્રીહરિવાક્યસુધાસિંધુ</h2>
    
    <div class="sub-tabs">
      <button class="sub-tab active" data-type="sanskrit">સંસ્કૃત</button>
      <button class="sub-tab" data-type="translation">અનુવાદ</button>
    </div>

    <!-- Sanskrit (shared from default bundle) -->
    <div class="content-item sanskrit active">
      {{ with .Page.Resources.GetMatch "hs-sa.md" }}
        {{ .Content | safeHTML }}
      {{ else }}
        <p>સંસ્કૃત કન્ટેન્ટ આવી રહ્યું છે...</p>
      {{ end }}
    </div>

    <!-- Translation: prefer current language, fallback to gu -->
    <div class="content-item translation">
      {{ $preferred := printf "hs-%s.md" $currentLang }}
      {{ $fallback := "hs-gu.md" }}
      {{ $trans := .Page.Resources.GetMatch $preferred }}
      {{ if not $trans }}
        {{ $trans = .Page.Resources.GetMatch $fallback }}
      {{ end }}
      {{ with $trans }}
        {{ .Content | safeHTML }}
      {{ else }}
        <p>અનુવાદ આવી રહ્યો છે...</p>
      {{ end }}
    </div>
  </div>

  <!-- Setumala Section -->
  <div id="setumala" class="section">
    <h2>સેતુમાળા ટીકા</h2>
    
    <div class="sub-tabs">
      <button class="sub-tab active" data-type="sanskrit">સંસ્કૃત</button>
      <button class="sub-tab" data-type="translation">અનુવાદ</button>
    </div>

    <!-- Sanskrit (shared from default bundle) -->
    <div class="content-item sanskrit active">
      {{ with .Page.Resources.GetMatch "st-sa.md" }}
        {{ .Content | safeHTML }}
      {{ else }}
        <p>સંસ્કૃત કન્ટેન્ટ આવી રહ્યું છે...</p>
      {{ end }}
    </div>

    <!-- Translation: prefer current language, fallback to gu -->
    <div class="content-item translation">
      {{ $preferred := printf "st-%s.md" $currentLang }}
      {{ $fallback := "st-gu.md" }}
      {{ $trans := .Page.Resources.GetMatch $preferred }}
      {{ if not $trans }}
        {{ $trans = .Page.Resources.GetMatch $fallback }}
      {{ end }}
      {{ with $trans }}
        {{ .Content | safeHTML }}
      {{ else }}
        <p>અનુવાદ આવી રહ્યો છે...</p>
      {{ end }}
    </div>
  </div>

</div>

<style>
.vachanamrut-hybrid-tabs { margin: 2rem 0; font-family: 'Noto Sans Gujarati', sans-serif; }
.main-tabs { display: flex; background: #8B4513; border-radius: 12px 12px 0 0; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
.main-tab { flex: 1; padding: 18px; background: #8B4513; color: white; border: none; font-size: 1.3rem; font-weight: bold; cursor: pointer; transition: background 0.3s; }
.main-tab:hover { background: #A0522D; }
.main-tab.active { background: #654321; }
.section { display: none; padding: 2rem; background: #fff8f0; border: 2px solid #8B4513; border-top: none; border-radius: 0 0 12px 12px; }
.section.active { display: block; }
.sub-tabs { display: flex; margin: 1.5rem 0; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
.sub-tab { flex: 1; padding: 14px; background: #D2691E; color: white; border: none; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background 0.3s; }
.sub-tab:hover { background: #E67E22; }
.sub-tab.active { background: #B8860B; }
.content-item { display: none; padding: 2rem; background: white; border-radius: 8px; line-height: 1.9; font-size: 1.2rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.content-item.active { display: block; }
h2 { color: #8B4513; border-bottom: 2px solid #D2691E; padding-bottom: 0.5rem; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.main-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      const section = btn.dataset.section;
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.main-tab').forEach(b => b.classList.remove('active'));
      document.getElementById(section).classList.add('active');
      btn.classList.add('active');
    });
  });

  document.querySelectorAll('.sub-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      const parentSection = btn.closest('.section');
      const type = btn.dataset.type;
      parentSection.querySelectorAll('.content-item').forEach(c => c.classList.remove('active'));
      parentSection.querySelectorAll('.sub-tab').forEach(b => b.classList.remove('active'));
      parentSection.querySelector(`.content-item.${type}`).classList.add('active');
      btn.classList.add('active');
    });
  });
});
</script>